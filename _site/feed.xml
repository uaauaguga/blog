<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.0.0">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2021-09-30T19:33:06+08:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Jin’s Post</title><subtitle>Notes &amp; blogs</subtitle><entry><title type="html">Notes on Metagenomics</title><link href="http://localhost:4000/jekyll/update/2021/09/27/notes-for-metagenomics.html" rel="alternate" type="text/html" title="Notes on Metagenomics" /><published>2021-09-27T20:14:51+08:00</published><updated>2021-09-27T20:14:51+08:00</updated><id>http://localhost:4000/jekyll/update/2021/09/27/notes-for-metagenomics</id><content type="html" xml:base="http://localhost:4000/jekyll/update/2021/09/27/notes-for-metagenomics.html">&lt;h3 id=&quot;metagenomic-profiling&quot;&gt;Metagenomic profiling&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Assign reads to reference sequences&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Estimate abundance of different microbes from amplicon sequencing or shutgun sequencing&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;alignment based methods vs. kmer based methods
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://huttenhower.sph.harvard.edu/metaphlan2/&quot;&gt;metaphlan2&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;kraken2&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;marker gene based methods vs. marker gene independent methods
    &lt;ul&gt;
      &lt;li&gt;metaphylan2, krakenunique&lt;/li&gt;
      &lt;li&gt;kraken2&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;nucleotide level analysis vs. protein level analysis
    &lt;ul&gt;
      &lt;li&gt;kraken2&lt;/li&gt;
      &lt;li&gt;Kaiju&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;benchmark study&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;assembly&quot;&gt;Assembly&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;metaspades: memory intesive
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://cab.spbu.ru/software/meta-spades/&quot;&gt;https://cab.spbu.ru/software/meta-spades/&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;2017, &lt;em&gt;Genome Research&lt;/em&gt;,&lt;a href=&quot;https://genome.cshlp.org/content/27/5/824.long&quot;&gt;metaSPAdes: a new versatile metagenomic assembler&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;megahit
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://github.com/voutcn/megahit&quot;&gt;https://github.com/voutcn/megahit&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;2015, &lt;em&gt;Bioinformatics&lt;/em&gt;, &lt;a href=&quot;https://academic.oup.com/bioinformatics/article/31/10/1674/177884&quot;&gt;MEGAHIT: an ultra-fast single-node solution for large and complex metagenomics assembly via succinct de Bruijn graph&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;idba-ud
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://github.com/loneknightpy/idba&quot;&gt;https://github.com/loneknightpy/idba&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;2012, &lt;em&gt;Bioinformatics&lt;/em&gt;, &lt;a href=&quot;https://academic.oup.com/bioinformatics/article/28/11/1420/266973&quot;&gt;IDBA-UD: a de novo assembler for single-cell and metagenomic sequencing data with highly uneven depth&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;binning&quot;&gt;Binning&lt;/h3&gt;

&lt;h3 id=&quot;strategy-for-removing-contaminations&quot;&gt;Strategy for removing contaminations&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;2014, &lt;em&gt;BMC Biology&lt;/em&gt;, &lt;a href=&quot;https://bmcbiol.biomedcentral.com/articles/10.1186/s12915-014-0087-z&quot;&gt;Reagent and laboratory contamination can critically impact sequence-based microbiome analyses&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;2019, &lt;em&gt;Trends in Microbiology&lt;/em&gt;, &lt;a href=&quot;https://www.sciencedirect.com/science/article/pii/S0966842X18302531&quot;&gt;Contamination in Low Microbial Biomass Microbiome Studies: Issues and Recommendations&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;2019, &lt;em&gt;Plos Computational Biology&lt;/em&gt;, &lt;a href=&quot;https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1006967&quot;&gt;Recentrifuge: Robust comparative analysis and contamination removal for metagenomics&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;genome-similarity&quot;&gt;Genome similarity&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;mash distance&lt;/li&gt;
  &lt;li&gt;whole genome alignment&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;distance-metrics-for-microbe-community&quot;&gt;Distance metrics for microbe community&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Bray%E2%80%93Curtis_dissimilarity&quot;&gt;Bray-Curtis distance&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/UniFrac&quot;&gt;unifrac distance&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;weighted unifrac distance&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;community-analysis-based-on-pairwise-distance&quot;&gt;Community analysis based on pairwise distance&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Multidimensional_scaling&quot;&gt;PCoA&lt;/a&gt; Analysis
    &lt;ul&gt;
      &lt;li&gt;PCoA (principle coordinate analysis) and MDS (multi-dimesional scaling) are essentially the same thing (but this seems the term MDS is seldom used by the microbiology community …)&lt;/li&gt;
      &lt;li&gt;project each sample in a distance matrix to a low dimensional space, attempt to preserve the pairwise distances&lt;/li&gt;
      &lt;li&gt;See
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;https://www.stat.pitt.edu/sungkyu/course/2221Fall13/lec8_mds_combined.pdf&quot;&gt;https://www.stat.pitt.edu/sungkyu/course/2221Fall13/lec8_mds_combined.pdf&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;https://repository.upenn.edu/cgi/viewcontent.cgi?article=1000&amp;amp;context=cis_papers&quot;&gt;https://repository.upenn.edu/cgi/viewcontent.cgi?article=1000&amp;amp;context=cis_papers&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Permutational_analysis_of_variance&quot;&gt;permanova&lt;/a&gt; analysis
    &lt;ul&gt;
      &lt;li&gt;For a given grouping (real grouping or shuffled grouping), a pseudo F statistics can be calculated&lt;/li&gt;
      &lt;li&gt;&lt;em&gt;P&lt;/em&gt; value can be calculated by shuffling group labels&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;differential-analysis&quot;&gt;Differential analysis&lt;/h3&gt;

&lt;h3 id=&quot;functional-annotation&quot;&gt;Functional annotation&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;eggnog: &lt;a href=&quot;http://eggnog.embl.de/&quot;&gt;http://eggnog.embl.de/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;visualization&quot;&gt;Visualization&lt;/h3&gt;

&lt;h3 id=&quot;genome-annotation&quot;&gt;Genome annotation&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;CDS prediction for prokaryotes&lt;/li&gt;
  &lt;li&gt;CDS prediction for eukaryotes&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;a-collection-of-workflows&quot;&gt;A collection of workflows&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;2021, &lt;em&gt;Plos Computational Biology&lt;/em&gt;, &lt;a href=&quot;https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1008716&quot;&gt;Metagenomics workflow for hybrid assembly, differential coverage binning, metatranscriptomics and pathway analysis (MUFFIN)&lt;/a&gt; also see &lt;a href=&quot;https://github.com/RVanDamme/MUFFIN&quot;&gt;https://github.com/RVanDamme/MUFFIN&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2016, &lt;em&gt;Genome Biology&lt;/em&gt;, &lt;a href=&quot;https://genomebiology.biomedcentral.com/articles/10.1186/s13059-016-1116-8&quot;&gt;IMP: a pipeline for reproducible referenceindependent integrated metagenomic and metatranscriptomic analyses&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;reviews-for-reference&quot;&gt;Reviews for reference&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;2018, &lt;em&gt;Nature Review Microbiology&lt;/em&gt;, &lt;a href=&quot;https://www.nature.com/articles/s41579-018-0029-9&quot;&gt;Best practices for analysing microbiomes&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;2020, &lt;em&gt;Genome Biology&lt;/em&gt;, &lt;a href=&quot;https://genomebiology.biomedcentral.com/articles/10.1186/s13059-020-02037-9&quot;&gt;The promise and challenge of cancer microbiome research&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;No update for a month … Write something to demonstrate I still alive despite for its insiganificance…&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><category term="jekyll" /><category term="update" /><summary type="html">Metagenomic profiling</summary></entry><entry><title type="html">latent Dirichlet allocation in genetics</title><link href="http://localhost:4000/jekyll/update/2021/08/13/latent-dirichlet-allocation.html" rel="alternate" type="text/html" title="latent Dirichlet allocation in genetics" /><published>2021-08-13T20:01:38+08:00</published><updated>2021-08-13T20:01:38+08:00</updated><id>http://localhost:4000/jekyll/update/2021/08/13/latent-dirichlet-allocation</id><content type="html" xml:base="http://localhost:4000/jekyll/update/2021/08/13/latent-dirichlet-allocation.html">&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Latent_Dirichlet_allocation&quot;&gt;https://en.wikipedia.org/wiki/Latent_Dirichlet_allocation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.cs.columbia.edu/~blei/papers/Blei2012.pdf&quot;&gt;Probabilistic topic models&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2003, &lt;em&gt;Journal of Machine Learning Research 3&lt;/em&gt;, &lt;a href=&quot;https://www.jmlr.org/papers/volume3/blei03a/blei03a.pdf&quot;&gt;Latent Dirichlet allocation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2000, &lt;em&gt;Genetics&lt;/em&gt;, &lt;a href=&quot;https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1461096/pdf/10835412.pdf&quot;&gt;Inference of Population Structure Using Multilocus Genotype Data&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><category term="jekyll" /><category term="update" /><summary type="html">https://en.wikipedia.org/wiki/Latent_Dirichlet_allocation Probabilistic topic models 2003, Journal of Machine Learning Research 3, Latent Dirichlet allocation 2000, Genetics, Inference of Population Structure Using Multilocus Genotype Data</summary></entry><entry><title type="html">A tool for download musics from bandcamp</title><link href="http://localhost:4000/jekyll/update/2021/08/08/download-musics-from-bandcamp.html" rel="alternate" type="text/html" title="A tool for download musics from bandcamp" /><published>2021-08-08T10:24:12+08:00</published><updated>2021-08-08T10:24:12+08:00</updated><id>http://localhost:4000/jekyll/update/2021/08/08/download-musics-from-bandcamp</id><content type="html" xml:base="http://localhost:4000/jekyll/update/2021/08/08/download-musics-from-bandcamp.html">&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/iheanyi/bandcamp-dl&quot;&gt;bandcamp-dl&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;There is also a more popular &lt;a href=&quot;https://github.com/ytdl-org/youtube-dl&quot;&gt;youtube-dl&lt;/a&gt; that inspires this tool …&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Worked on hongkong VPS&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;To be updated
    &lt;ul&gt;
      &lt;li&gt;Configure local proxy for downloading&lt;/li&gt;
      &lt;li&gt;Learn their implementation&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><category term="jekyll" /><category term="update" /><summary type="html">bandcamp-dl There is also a more popular youtube-dl that inspires this tool … Worked on hongkong VPS</summary></entry><entry><title type="html">Notes on SMTP</title><link href="http://localhost:4000/jekyll/update/2021/07/31/notes-on-SMTP.html" rel="alternate" type="text/html" title="Notes on SMTP" /><published>2021-07-31T21:30:12+08:00</published><updated>2021-07-31T21:30:12+08:00</updated><id>http://localhost:4000/jekyll/update/2021/07/31/notes-on-SMTP</id><content type="html" xml:base="http://localhost:4000/jekyll/update/2021/07/31/notes-on-SMTP.html">&lt;h2 id=&quot;play-with-smtp&quot;&gt;Play with SMTP&lt;/h2&gt;

&lt;h3 id=&quot;用telnet和smtp服务器交互在命令行发送邮件&quot;&gt;用telnet和SMTP服务器交互在命令行发送邮件&lt;/h3&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# connect to 163's SMTP server&lt;/span&gt;
telnet smtp.163.com 25
&lt;span class=&quot;c&quot;&gt;## Trying 220.181.12.18...&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## Connected to smtp.163.com.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## Escape character is '^]'.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## 220 163.com Anti-spam GT for Coremail System (163com[20141201])&lt;/span&gt;
HELO fs &lt;span class=&quot;c&quot;&gt;# a shaking is required prior to sending email &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## 250 OK&lt;/span&gt;
auth login &lt;span class=&quot;c&quot;&gt;# login SMTP server&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## 334 dXNlcm5hbWU6 # this is a base64 encoding, validate this in python with base64.b64decode(&quot;dXNlcm5hbWU6&quot;), which return b'username:'&lt;/span&gt;
xxxxxxxxxxxx &lt;span class=&quot;c&quot;&gt;# based 64 encoded user name&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## 334 UGFzc3dvcmQ6 # b'Password:'&lt;/span&gt;
xxxxxxxxxxxx &lt;span class=&quot;c&quot;&gt;# based 64 encoded user password&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## 235 Authentication successful&lt;/span&gt;
mail from:&amp;lt;jinyf1998@163.com&amp;gt; &lt;span class=&quot;c&quot;&gt;# input source email address&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## 250 Mail OK&lt;/span&gt;
rcpt to:&amp;lt;jyf20@mails.tsinghua.edu.cn&amp;gt; &lt;span class=&quot;c&quot;&gt;# input target email adress&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## 250 Mail OK&lt;/span&gt;
data &lt;span class=&quot;c&quot;&gt;# input email content&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## 354 End data with &amp;lt;CR&amp;gt;&amp;lt;LF&amp;gt;.&amp;lt;CR&amp;gt;&amp;lt;LF&amp;gt;&lt;/span&gt;
subject: hello hawaii
from: &amp;lt;jinyf1998@163.com&amp;gt;
to: &amp;lt;jyf20@mails.tsinghua.edu.cn&amp;gt;

tell me, is some thing eluding you?
sunshine?
Is this not what you expected to see?
If you wanna find out what is behind this cold eyes ...
&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## 250 Mail OK queued as smtp14,EsCowADnavwKVwVhQPiWxQ--.36143S2 1627740013&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 这时jyf20@mails.tsinghua.edu.cn会收到来自jinyf1998@163.com的邮件&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;在python中利用smtp发送邮件&quot;&gt;在python中利用SMTP发送邮件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Send a email contains plain text&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Import required libraries
&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;email&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;smtplib&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;email.utils&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;formataddr&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;email.mime.text&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIMEText&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# define content of the email
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIMEText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'What is behind this cold eyes'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'plain'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'utf-8'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'From'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;formataddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'To'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;formataddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;receiver&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;receiver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Subject'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'Test Python SMTP'&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# user information for login
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'xxx'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;receiver&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'xxx'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'xxx'&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;smtpObj&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;smtplib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SMTP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; 
&lt;span class=&quot;c1&quot;&gt;# connect to SMTP server
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;smtpObj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;smtp.163.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;    
&lt;span class=&quot;n&quot;&gt;smtpObj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;login&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  

&lt;span class=&quot;c1&quot;&gt;# send the email
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;smtpObj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendmail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;receiver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;as_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Attatch a file to the email&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;email.utils&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;formataddr&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;email.mime.base&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIMEBase&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;email.mime.text&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIMEText&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;email.mime.multipart&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIMEMultipart&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;email&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoders&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIMEMultipart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'From'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;formataddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'To'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;formataddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;receiver&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;receiver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Subject'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'Test Python SMTP with attachment'&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MIMEText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'hey you'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'plain'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'utf-8'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'lyric.txt.gz'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'rb'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;mime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIMEBase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'application'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'x-gzip'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'lyric.txt.gz'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;mime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add_header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Content-Disposition'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'attachment'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'lyric.txt.gz'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;mime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;set_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;encoders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encode_base64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# ... send the message as for plain text
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="jekyll" /><category term="update" /><summary type="html">Play with SMTP</summary></entry><entry><title type="html">Docker Basic</title><link href="http://localhost:4000/jekyll/update/2021/07/30/docker-basic.html" rel="alternate" type="text/html" title="Docker Basic" /><published>2021-07-30T07:10:10+08:00</published><updated>2021-07-30T07:10:10+08:00</updated><id>http://localhost:4000/jekyll/update/2021/07/30/docker-basic</id><content type="html" xml:base="http://localhost:4000/jekyll/update/2021/07/30/docker-basic.html">&lt;h2 id=&quot;docker-basics&quot;&gt;docker basics&lt;/h2&gt;

&lt;h3 id=&quot;installation&quot;&gt;installation&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;install on ubuntu&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;docker.io
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;check whether docker client and server is properly installed&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker version
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Run docker without sudo&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;groupadd docker
usermod &lt;span class=&quot;nt&quot;&gt;-aG&lt;/span&gt; docker &lt;span class=&quot;nv&quot;&gt;$USER&lt;/span&gt;
newgrp docker
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;image-and-container&quot;&gt;image and container&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;image(镜像)相当于虚拟机模板或类&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;container（容器）相当于虚拟机或类的实例&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;check locally available images&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker images
&lt;span class=&quot;c&quot;&gt;# docker image ls will also work&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;check running containers&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker container &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;show both running and stopped container&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker container &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;remove docker images&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker rmi image_id
&lt;span class=&quot;c&quot;&gt;# docker image rm image_id will also work&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;start/stop/remove container instances&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker container start container_id
docker container stop container_id
docker container &lt;span class=&quot;nb&quot;&gt;rm &lt;/span&gt;container_id
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;run a exutable with docker container from a image&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# run a exutable with docker container from a image&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# docker container run name.or.id.of.image path.to.exutable parameters&lt;/span&gt;
docker run ubuntu &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'hello world'&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 'hello world'&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# if you want docker remove the container after exited, add --rm&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# docker container --rm run name.or.id.of.image path.to.exutable&lt;/span&gt;
docker run &lt;span class=&quot;nt&quot;&gt;--rm&lt;/span&gt; ubuntu &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'hello world'&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 'hello world'&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# If the docker container has a prespecified entry point&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# docker run --rm image.with.entry.point parameters&lt;/span&gt;
docker run &lt;span class=&quot;nt&quot;&gt;--rm&lt;/span&gt; jinyf1998/cowsay.v0 goodbye cold world
&lt;span class=&quot;c&quot;&gt;# ____________________&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&amp;lt; goodbye cold world &amp;gt;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# --------------------&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#        \   ^__^&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#         \  (oo)\_______&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#            (__)\       )\/\&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#                ||----w |&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#                ||     ||&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;docker container exec&lt;/code&gt;和&lt;code class=&quot;highlighter-rouge&quot;&gt;docker container run&lt;/code&gt;功能比较类似，区别在于&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;docker-volume-数据卷&quot;&gt;docker volume (数据卷)&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;external storage&lt;/li&gt;
  &lt;li&gt;有的时候你希望docker利用宿主机上的存储&lt;/li&gt;
  &lt;li&gt;Docker volumes are directories that are not part of the container’s UFS&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 把当前路径下的programming目录mount到docker container 的/data路径下&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 如果想挂载多个目录,多次指定-v就可以了&lt;/span&gt;
docker run &lt;span class=&quot;nt&quot;&gt;-it&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$PWD&lt;/span&gt;/programming:/data ubuntu /bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;build-customized-docker-image&quot;&gt;build customized docker image&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;two ways
    &lt;ul&gt;
      &lt;li&gt;install dependency in docker interactive terminal, than commit a snapshot of the container with &lt;code class=&quot;highlighter-rouge&quot;&gt;docker commit&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;using &lt;code class=&quot;highlighter-rouge&quot;&gt;Dockerfile&lt;/code&gt;, and run &lt;code class=&quot;highlighter-rouge&quot;&gt;docker build&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;优劣比较&lt;a href=&quot;https://zzq23.blog.csdn.net/article/details/80571262&quot;&gt;https://zzq23.blog.csdn.net/article/details/80571262&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;The docker commit method is not currently recommended, as building with a Dockerfile is far more flexible and powerful&lt;/li&gt;
  &lt;li&gt;常用Dockerfile 关键字
    &lt;ul&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;FROM&lt;/code&gt; 从那个已有镜像开始构建&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;RUN&lt;/code&gt; 后跟在构建镜像的过程中执行的命令&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ENV&lt;/code&gt; 设置环境变量&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ADD&lt;/code&gt; 将building context的文件导入镜像&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;COPY&lt;/code&gt; 和&lt;code class=&quot;highlighter-rouge&quot;&gt;ADD&lt;/code&gt;的区别在于&lt;code class=&quot;highlighter-rouge&quot;&gt;COPY&lt;/code&gt;只从本地获得数据&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;VOLUME&lt;/code&gt; 挂载数据卷&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ENTRYPOINT&lt;/code&gt; 运行容器的进入程序&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CMD&lt;/code&gt; 容器运行时执行的命令&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;An example&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dockerfile&quot;&gt;FROM debian
MAINTAINER John Smith &amp;lt;john@smith.com&amp;gt;
RUN apt-get update &amp;amp;&amp;amp; apt-get install -y cowsay fortune
COPY entrypoint.sh /
ENTRYPOINT [&quot;/entrypoint.sh&quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
  &lt;li&gt;run&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Assume a Dockerfile is present in current directory&lt;/span&gt;
docker build &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; target.image.name &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;docker-hub&quot;&gt;docker hub&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;pull docker image from docker hub with &lt;code class=&quot;highlighter-rouge&quot;&gt;docker pull&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;push your docker image to docker hub&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;tag the docker image to your own repo with &lt;code class=&quot;highlighter-rouge&quot;&gt;docker tag&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;run &lt;code class=&quot;highlighter-rouge&quot;&gt;docker push&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;reference&quot;&gt;Reference&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://dockerbook.com/&quot;&gt;The Docker Book&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.oreilly.com/library/view/using-docker/9781491915752/&quot;&gt;Using Docker: Developing and Deploying Software with Containers&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><category term="jekyll" /><category term="update" /><summary type="html">docker basics</summary></entry><entry><title type="html">Split Sequencing Reads</title><link href="http://localhost:4000/jekyll/update/2021/07/10/partitioning-of-sequencing-reads.html" rel="alternate" type="text/html" title="Split Sequencing Reads" /><published>2021-07-10T09:52:24+08:00</published><updated>2021-07-10T09:52:24+08:00</updated><id>http://localhost:4000/jekyll/update/2021/07/10/partitioning-of-sequencing-reads</id><content type="html" xml:base="http://localhost:4000/jekyll/update/2021/07/10/partitioning-of-sequencing-reads.html">&lt;ul&gt;
  &lt;li&gt;We may want to filter some unwanted sequences from fastq file prior to down stream analysis
    &lt;ul&gt;
      &lt;li&gt;rRNA for RNA seq data&lt;/li&gt;
      &lt;li&gt;host reads for metagenomic data&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;remove-rrna-sequence&quot;&gt;Remove rRNA sequence&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;For single species RNA-seq, simply map reads to rRNA reference of these species, keep unaligned reads&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;For metagenomic data, may try &lt;a href=&quot;https://github.com/biocore/sortmerna&quot;&gt;sortmerna&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# download rRNA reference from their github repo https://github.com/biocore/sortmerna/tree/master/data/rRNA_databases&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# build sortmerna index&lt;/span&gt;
sortmerna &lt;span class=&quot;nt&quot;&gt;-ref&lt;/span&gt; reference/rRNA/fasta/rRNA.fasta &lt;span class=&quot;nt&quot;&gt;-index&lt;/span&gt; 1 &lt;span class=&quot;nt&quot;&gt;--idx-dir&lt;/span&gt; reference/rRNA/sortmerna-index 
&lt;span class=&quot;c&quot;&gt;# -index 1: build index and exit&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# run sortmerna&lt;/span&gt;
 sortmerna &lt;span class=&quot;nt&quot;&gt;-ref&lt;/span&gt; reference/rRNA/fasta/rRNA.fasta &lt;span class=&quot;nt&quot;&gt;--idx-dir&lt;/span&gt; reference/rRNA/sortmerna-index &lt;span class=&quot;nt&quot;&gt;--reads&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;input.fastq_1&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--reads&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;input.fastq_2&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--fastx&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--workdir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;working_dir&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--index&lt;/span&gt; 0 &lt;span class=&quot;nt&quot;&gt;--out2&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--other&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--threads&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;threads&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# -index 0: perform rRNA matching on existed index&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;For annotate rRNA sequence in assembled sequence contigs of bacteria genome , try &lt;a href=&quot;https://github.com/tseemann/barrnap&quot;&gt;barrnap&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;remove-host-genome-sequence&quot;&gt;Remove host genome sequence&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;align reads to host genome&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;bmtagger
    &lt;ul&gt;
      &lt;li&gt;Used in HMP project, see &lt;a href=&quot;https://www.hmpdacc.org/hmp/doc/HumanSequenceRemoval_SOP.pdf&quot;&gt;https://www.hmpdacc.org/hmp/doc/HumanSequenceRemoval_SOP.pdf&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;bbduk.sh in bbmap suites&lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><category term="jekyll" /><category term="update" /><summary type="html">We may want to filter some unwanted sequences from fastq file prior to down stream analysis rRNA for RNA seq data host reads for metagenomic data</summary></entry><entry><title type="html">On Masking of Low Complexity Sequence</title><link href="http://localhost:4000/jekyll/update/2021/07/09/on-masking-of-low-complexiity-sequence.html" rel="alternate" type="text/html" title="On Masking of Low Complexity Sequence" /><published>2021-07-09T09:52:24+08:00</published><updated>2021-07-09T09:52:24+08:00</updated><id>http://localhost:4000/jekyll/update/2021/07/09/on-masking-of-low-complexiity-sequence</id><content type="html" xml:base="http://localhost:4000/jekyll/update/2021/07/09/on-masking-of-low-complexiity-sequence.html">&lt;h3 id=&quot;handle-low-complexity-sequence&quot;&gt;Handle low complexity sequence&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;masking low complexity regions in a long sequence&lt;/li&gt;
  &lt;li&gt;filter read with low sequence complexity in NGS data&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;method&quot;&gt;Method&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;entropy
    &lt;ul&gt;
      &lt;li&gt;The &lt;a href=&quot;https://kodomo.fbb.msu.ru/FBB/year_10/ppt/SEG-93.pdf&quot;&gt;SEG algorithm&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;entropy of 3-mer in sliding window&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;dust score of 3 mer in sliding window
    &lt;ul&gt;
      &lt;li&gt;see &lt;a href=&quot;https://kodomo.fbb.msu.ru/FBB/year_09/ppt/DUST.pdf&quot;&gt;https://kodomo.fbb.msu.ru/FBB/year_09/ppt/DUST.pdf&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;perform local alignment to sequence itself and known repeative elements&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;tools&quot;&gt;Tools&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.repeatmasker.org/&quot;&gt;repeatmasker&lt;/a&gt;, screens DNA sequences for interspersed repeats and low complexity DNA sequences&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;NCBI’s blast is shipped with multiple masking tools, see &lt;a href=&quot;https://www.ncbi.nlm.nih.gov/books/NBK569845/&quot;&gt;https://www.ncbi.nlm.nih.gov/books/NBK569845/&lt;/a&gt; for detail&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;segmasker&lt;/li&gt;
      &lt;li&gt;dustmasker&lt;/li&gt;
      &lt;li&gt;windowmasker&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&quot;language-{bash}&quot;&gt;# example usage of dustmasker
dustmasker -outfmt fasta -parse_seqids -in {input.fasta} -out {masked.fasta}
# low complexity sequence set set to lower case, if you want to set it to N, run
sed '/^&amp;gt;/! s/[[:lower:]]/N/g' {masked.fasta} &amp;gt; {hardmasked.fasta} # see https://www.biostars.org/p/13677/s
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://meme-suite.org/meme/doc/dust.html&quot;&gt;dust&lt;/a&gt;, a program shipped with MEME suites&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&quot;language-{bash}&quot;&gt;dust sequences.fasta {cutoff} &amp;gt; sequences.masked.fasta
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;NCBI’s &lt;a href=&quot;ftp://ftp.ncbi.nih.gov/pub/seg/seg/&quot;&gt;seg&lt;/a&gt;, segment sequence by local complexity. A very old tool …&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;sequence complexity (entropy and dust) based read filter in &lt;a href=&quot;http://prinseq.sourceforge.net/&quot;&gt;prinseq&lt;/a&gt;, also see &lt;a href=&quot;https://chipster.csc.fi/manual/prinseq-complexity-filter.html&quot;&gt;https://chipster.csc.fi/manual/prinseq-complexity-filter.html&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;I write a small script that assign a single 3-mer count based dust or entropy score to each reads in fastq file, see &lt;a href=&quot;https://github.com/uaauaguga/NGS-Analysis-Notes/blob/master/scripts/sequence-complexity.py&quot;&gt;https://github.com/uaauaguga/NGS-Analysis-Notes/blob/master/scripts/sequence-complexity.py&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><category term="jekyll" /><category term="update" /><summary type="html">Handle low complexity sequence masking low complexity regions in a long sequence filter read with low sequence complexity in NGS data</summary></entry><entry><title type="html">Notes for deep learning in biological sequence analysis</title><link href="http://localhost:4000/jekyll/update/2021/06/25/deeplearning-for-sequence-comparison.html" rel="alternate" type="text/html" title="Notes for deep learning in biological sequence analysis" /><published>2021-06-25T13:51:23+08:00</published><updated>2021-06-25T13:51:23+08:00</updated><id>http://localhost:4000/jekyll/update/2021/06/25/deeplearning-for-sequence-comparison</id><content type="html" xml:base="http://localhost:4000/jekyll/update/2021/06/25/deeplearning-for-sequence-comparison.html">&lt;ul&gt;
  &lt;li&gt;A collection of studies that applies deep learning to sequence comparison&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;related-resources&quot;&gt;Related Resources&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;2017, Cell Systems, &lt;a href=&quot;https://linkinghub.elsevier.com/retrieve/pii/S2405-4712(17)30542-2&quot;&gt;Enhancing Evolutionary Couplings with DeepConvolutional Neural Networks&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;2019, &lt;a href=&quot;https://arxiv.org/abs/1912.05625&quot;&gt;Pre-Training of Deep Bidirectional Protein Sequence Representations with Structural Information&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;2019, Nature Method, &lt;a href=&quot;https://www.nature.com/articles/s41592-019-0598-1&quot;&gt;Unified rational protein engineering with sequence-based deep representation learning&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://github.com/fhalab/embeddings_reproduction&quot;&gt;https://github.com/fhalab/embeddings_reproduction&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;2018, NeurIPS, &lt;a href=&quot;https://proceedings.neurips.cc/paper/2018/file/d0921d442ee91b896ad95059d13df618-Paper.pdf&quot;&gt;Neural Edit Operations for Biological Sequences&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;2021, ICLR, &lt;a href=&quot;https://arxiv.org/abs/2006.15222&quot;&gt;Bertology Meets Biology Interpreting Attention Protein Language Moldes&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;2021, Bioinformatics, &lt;a href=&quot;https://academic.oup.com/bioinformatics/advance-article/doi/10.1093/bioinformatics/btab083/6128680&quot;&gt;DNABERT: pre-trained Bidirectional Encoder Representations from Transformers model for DNA-language in genome&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://github.com/jerryji1993/DNABERT&quot;&gt;https://github.com/jerryji1993/DNABERT&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;2021, PNAS, &lt;a href=&quot;https://www.pnas.org/content/118/15/e2016239118&quot;&gt;Biological structure and function emerge from scaling unsupervised learning to 250 million protein sequences&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://github.com/facebookresearch/esm&quot;&gt;https://github.com/facebookresearch/esm&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;2021, Current Potocols, &lt;a href=&quot;https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.113&quot;&gt;Learned Embeddings from Deep Learning to Visualize and Predict Protein Sets&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://github.com/sacdallago/bio_embeddings&quot;&gt;https://github.com/sacdallago/bio_embeddings&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><category term="jekyll" /><category term="update" /><summary type="html">A collection of studies that applies deep learning to sequence comparison</summary></entry><entry><title type="html">TMM normalization in python</title><link href="http://localhost:4000/jekyll/update/2021/06/25/TMM-normalization-in-python.html" rel="alternate" type="text/html" title="TMM normalization in python" /><published>2021-06-25T13:16:51+08:00</published><updated>2021-06-25T13:16:51+08:00</updated><id>http://localhost:4000/jekyll/update/2021/06/25/TMM-normalization-in-python</id><content type="html" xml:base="http://localhost:4000/jekyll/update/2021/06/25/TMM-normalization-in-python.html">&lt;ul&gt;
  &lt;li&gt;TMM method in &lt;a href=&quot;https://bioconductor.org/packages/release/bioc/html/edgeR.html&quot;&gt;edgeR&lt;/a&gt; package is a popular method for RNA seq count matrix normalization, here I implement a python version&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;brief-description&quot;&gt;Brief description&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;consider n gene, m sample in a (n,m) matrix&lt;/li&gt;
  &lt;li&gt;take upper 75% quantile of each sample in expression matrix, divide it by library size, called f75 (m,)&lt;/li&gt;
  &lt;li&gt;take sample nearest to mean as reference, you can set any sample as reference&lt;/li&gt;
  &lt;li&gt;calculate TMM by compare each sample to the reference sample&lt;/li&gt;
  &lt;li&gt;define: gene-wise log-fold-changes, also called log ratio of expression&lt;/li&gt;
&lt;/ul&gt;

\[M_g = \log_2{\frac{observation}{observation.libsize}} - \log_2{\frac{reference}{reference.libsize}}\]

&lt;ul&gt;
  &lt;li&gt;define: absolute expression level&lt;/li&gt;
&lt;/ul&gt;

\[A_g = \frac{1}{2}(\log_{2}\frac{observation}{observation.libsize}+\log_2{\frac{reference}{reference.libsize}})\]

&lt;ul&gt;
  &lt;li&gt;define: estimated asymptotic variance&lt;/li&gt;
&lt;/ul&gt;

\[\\ V_g  = \frac{observation.libsize-observation}{observation.libsize*observation}+\frac{reference.libsize-reference}{reference.libsize*reference} 
      \\ = \frac{1}{observation} - \frac{1}{observation.libsize} + \frac{1}{reference} - \frac{1}{reference.libsize}\]

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Keep expression in quantile  [0.3,0.7] and relative expression in quantile [0.3,0.7]&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;calculate average of \(M_g\), weighted by \(1/V_g\)&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

\[f = \frac{\sum\frac{1}{V_g}M_g}{\sum\frac{1}{V_g}}\]

&lt;ul&gt;
  &lt;li&gt;The TMM factor is \(2^f\)&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;a-python-implementation&quot;&gt;A python implementation&lt;/h3&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pandas&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pd&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;numpy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;


&lt;span class=&quot;c1&quot;&gt;# Get TMM factor of a sample, given the reference sample
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_TMM_factor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count_observed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count_reference&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;logratioTrim&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sumTrim&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.05&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Acutoff&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1e10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_observed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_reference&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;# Mask genes with zero count in at least one of two samples
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;mask&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count_observed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count_reference&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;count_observed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_observed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;copy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;count_reference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_reference&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;copy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;observed_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_observed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;reference_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_reference&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;# Calculate log fold change
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;M&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count_observed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observed_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count_reference&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reference_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1e-6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    

    &lt;span class=&quot;c1&quot;&gt;# Calculate absolute expression 
&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;A&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count_observed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observed_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count_reference&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reference_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;V&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count_observed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observed_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count_reference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reference_size&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;mask&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1e10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;A&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    

    &lt;span class=&quot;c1&quot;&gt;# Get genes that is believed to not be differentially expressed in two sample
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;# And genes which expression is not too high or too low
&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;M_l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;A_l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;logratioTrim&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sumTrim&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;M_h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;A_h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;M_l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;A_l&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;M_rank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A_rank&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;genes_selected&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;M_rank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M_rank&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M_l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M_rank&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M_h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A_rank&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A_l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A_rank&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A_h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;V&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;genes_selected&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;genes_selected&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;


&lt;span class=&quot;c1&quot;&gt;# Get TMM scaling factor for a expression matrix
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_scaling_factor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expression_matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reference&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;scaling_factors&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;expression_matrix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;columns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_TMM_factor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expression_matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expression_matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reference&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;scaling_factors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;scaling_factors&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Series&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scaling_factors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;scaling_factors&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scaling_factors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scaling_factors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scaling_factors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expression_matrix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;columns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;



&lt;span class=&quot;c1&quot;&gt;# example usage
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;expression_matrix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read_csv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;TCGA-CRC-counts.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sep&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index_col&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;expression_matrix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;expression_matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expression_matrix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;axis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;scaling_factor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_scaling_factor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expression_matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;TCGA-A6-5662-11A&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;reference&quot;&gt;Reference&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;TMM’s publication: &lt;a href=&quot;https://genomebiology.biomedcentral.com/articles/10.1186/gb-2010-11-3-r25&quot;&gt;https://genomebiology.biomedcentral.com/articles/10.1186/gb-2010-11-3-r25&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Source code in edgeR: &lt;a href=&quot;https://rdrr.io/bioc/edgeR/src/R/calcNormFactors.R&quot;&gt;https://rdrr.io/bioc/edgeR/src/R/calcNormFactors.R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><category term="jekyll" /><category term="update" /><summary type="html">TMM method in edgeR package is a popular method for RNA seq count matrix normalization, here I implement a python version</summary></entry><entry><title type="html">Hash and Approximate Similarity Search</title><link href="http://localhost:4000/jekyll/update/2021/06/15/approximate-similarity-search.html" rel="alternate" type="text/html" title="Hash and Approximate Similarity Search" /><published>2021-06-15T20:41:20+08:00</published><updated>2021-06-15T20:41:20+08:00</updated><id>http://localhost:4000/jekyll/update/2021/06/15/approximate-similarity-search</id><content type="html" xml:base="http://localhost:4000/jekyll/update/2021/06/15/approximate-similarity-search.html">&lt;h2 id=&quot;locality-sensitive-hashing&quot;&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Locality-sensitive_hashing&quot;&gt;Locality sensitive hashing&lt;/a&gt;&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;A good tutorial &lt;a href=&quot;http://infolab.stanford.edu/~ullman/mmds/ch3a.pdf&quot;&gt;http://infolab.stanford.edu/~ullman/mmds/ch3a.pdf&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Also see &lt;a href=&quot;https://randorithms.com/2019/09/19/Visual-LSH.html&quot;&gt;4 Pictures that Explain LSH - Locality Sensitive Hashing Tutorial&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.stat.ucdavis.edu/~chohsieh/teaching/ECS289G_Fall2016/lecture10.pdf&quot;&gt;http://www.stat.ucdavis.edu/~chohsieh/teaching/ECS289G_Fall2016/lecture10.pdf&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;approximation-for-hamming-distance&quot;&gt;Approximation for Hamming Distance&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;Bit sampling LSH, that is random choose a subset of bits&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;approximation-for-jaccard-distance&quot;&gt;Approximation for Jaccard Distance&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;minhash&lt;/strong&gt; can be utilized to approximate &lt;strong&gt;Jaccard distance&lt;/strong&gt; between k-mer sets of two large genome, see &lt;a href=&quot;https://uaauaguga.github.io/jekyll/update/2021/05/15/Alignment-free-method-for-sequence-comparison.html&quot;&gt;https://uaauaguga.github.io/jekyll/update/2021/05/15/Alignment-free-method-for-sequence-comparison.html&lt;/a&gt;. The same technique can be applied to estimate the similarity between tow document, or large sparse binary vector.&lt;/li&gt;
  &lt;li&gt;我们如果随机取k行出来，近似的不是Jaccard距离，而是Hamming距离&lt;/li&gt;
  &lt;li&gt;“min” here means set with smallest hash value&lt;/li&gt;
  &lt;li&gt;If we encode k-mer sets with binary table, a minhash function h that maps sets to rows, or a implicit reordering of the table rows&lt;/li&gt;
  &lt;li&gt;minhash直接输出的结果称为signature matrix,每一列是一个sample，每一行是不同的哈希值&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;approximation-for-cosine-distance&quot;&gt;Approximation for Cosine Distance&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;“Signed Random Projections”&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;reading&quot;&gt;Reading&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;2014,&lt;a href=&quot;https://arxiv.org/pdf/1408.2927.pdf&quot;&gt;Hashing for Similarity Search: A Survey&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2017,&lt;a href=&quot;https://arxiv.org/pdf/1702.05425.pdf&quot;&gt;Exact clustering in linear time&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><category term="jekyll" /><category term="update" /><summary type="html">Locality sensitive hashing</summary></entry></feed>